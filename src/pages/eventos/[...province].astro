---
import { type CollectionEntry, getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { slugify } from "../../utils";
import Calendar from "../../components/Calendar.astro";

export async function getStaticPaths() {
    const events = await getCollection("event");
    const provinces = new Set<string>();
    events.forEach((event: CollectionEntry<"event">) => {
        if (event.data.province) {
            provinces.add(slugify(event.data.province));
        }
    });
    return Array.from(provinces).map((province) => ({
        params: { province },
        props: { province },
    }));
}

const events = await getCollection("event", ({ data }) =>
    Astro.params.province.match(slugify(data.province || "")),
);
---

<Layout>
    <Header />
    <main class="container mx-auto px-4">
        <Calendar events={events} />
    </main>
    <Footer />
</Layout>
